# Reg key fixes for https://www.tenable.com/blog/cve-2021-34527-microsoft-releases-out-of-band-patch-for-printnightmare-vulnerability-in-windows

$RegKeyPath = 'HKLM:\SOFTWARE\Policies\Microsoft\Windows NT\Printers'
$RegKeyPathPointAndPrint = 'HKLM:\SOFTWARE\Policies\Microsoft\Windows NT\Printers\PointAndPrint'
$NoWarningNoElevationOnInstallKey = 'HKLM:\SOFTWARE\Policies\Microsoft\Windows NT\Printers\PointAndPrint\NoWarningNoElevationOnInstall'
$NoWarningNoElevationOnUpdateKey = 'HKLM:\SOFTWARE\Policies\Microsoft\Windows NT\Printers\PointAndPrint\NoWarningNoElevationOnUpdate'

# Check if Reg Key path exists, if not create it

if(-not (Test-Path "$RegKeyPathPointAndPrint")){

    New-Item -Path $RegKeyPath -Name 'PointAndPrint'
}

# Check if NoWarningNoElevationOnInstall reg key exists, if not create it

if(-not (Test-Path $NoWarningNoElevationOnInstallKey)){

    New-ItemProperty -Path $RegKeyPathPointAndPrint -Name 'NoWarningNoElevationOnInstall' -Value '0' -PropertyType DWORD -Force
}

# Check if NoWarningNoElevationOnUpdate reg key exists, if not create it

if(-not (Test-Path $NoWarningNoElevationOnUpdateKey)){

    New-ItemProperty -Path $RegKeyPathPointAndPrint -Name 'NoWarningNoElevationOnUpdate' -Value '0' -PropertyType DWORD -Force
}